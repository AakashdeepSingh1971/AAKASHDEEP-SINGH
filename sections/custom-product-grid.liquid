<div class="section2">
  <h1>Tisso vison in the wild</h1>
  <div class="productGrid">
    {% assign products = collections.all.products %}

    {% for product in products limit: 6 %}
      <div class="productItem">
        {{ product | image_url: width: 433 | image_tag: width: 433 }}
        <button
          class="open-popup"
          onclick="fetchProduct({{ product.id }})"
          data-product-id="{{ product.id }}"
        >
          +
        </button>
      </div>
    {% endfor %}
  </div>

  <div class="popup" id="product-popup">
    <div class="popup-content">
      <span class="close-popup" onclick="closePopup()">X</span>
      <div
        class="popupMainDiv"
        style="
          height: 90%;
          justify-content: space-between;
        "
      >
        <div class="popupMainDiv">
          <div class="firstDiv">
            <img id="popupImg" src="" alt="Product Image" class="productImage" height="140" width="120">
            <div class="popupTextDiv">
              <h2 id="popup-title"></h2>
              <p id="popup-price"></p>
              <p id="popup-description"></p>
            </div>
          </div>
          <div class="secondDiv">
            <div class="color-selector">
              <p class="colorHeader">Color</p>
              <div class="color-button-group" id="color-button-group">
                <!--
                  <div class="color-option" id="firstColor" data-color="White">
                    <span class="colorDiv" style="background-color:#fff;"></span>
                    <span class="colorType">White</span>
                  </div>
                  <div class="divider"></div>
                  <div class="color-option" id="secondColor" data-color="Black">
                    <span class="colorDiv" style="background-color:#000;"> </span>
                    <span class="colorType">Black</span>
                  </div>
                -->
              </div>

              <div class="size-selector">
                <label>Size</label>
                <select id="size-options" class="size-options">
                  <option disabled selected>Choose your size</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        <button id="add-to-cart" class="add-to-cart-button">ADD TO CART</button>
      </div>
    </div>
  </div>
</div>
<style>
      .colorHeader{
        font-family: Jost;
    font-size: 14px;
    font-weight: 400;
    line-height: 18.2px;
    text-align: left;

      }
            .secondDiv .color-selector {
                  width: 271px;

              }
            .secondDiv  .color-button-group {
                  display: flex;

                  height: 40.44px;
                border: 0.5px solid rgba(0, 0, 0, 1)
              }
           .secondDiv   .color-option {
                  flex: 1;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  cursor: pointer;
                  position: relative;
                  overflow: hidden;
              }
           .secondDiv   .color-option span {
                  position: relative;
                  z-index: 2;
                  transition: color 0.3s ease;
              }
           .secondDiv   .color-option::before {
                  content: '';
                  position: absolute;
                  top: 0;
                  left: 0;
                  width: 0;
                  height: 100%;
                  background-color: black;
                  transition: width 0.3s ease;

              }
           .secondDiv   .color-option.selected::before {
                  width: 100%;
              }
          .secondDiv    .color-option.selected span {
                  color: white;
              }
           .secondDiv   .divider {
                  width: 1px;
                  background-color: #ccc;
              }

      .colorDiv{
        border:2px solid black;
        height:100%;

        width: 5.81px;
        font-family: Jost;
  font-size: 18px;
  font-weight: 400;
  line-height: 18px;
  letter-spacing: -0.02em;
  text-align: left;


      border: 0.5px solid rgba(0, 0, 0, 1);
      gap: 0px;

      opacity: 0px;

      }
      .colorType{
        flex:1;
        text-align:center;
      }    .close-popup{
                display: flex;
            justify-content: flex-end;
          }
              .popup p{
                margin:0;
              }
            .popup-content{
              width: 311px;
          height: 447px;

            }
              .popupMainDiv{
                display:flex;
                flex-direction:column;
                gap:10px;

              }
              .firstDiv{
                gap:10px;
                display:flex;
              }
              .popupTextDiv{
                display:flex;
                flex-direction:column;
                gap:15px;
              }
              #popup-title{
                font-family: Jost;
            font-size: 16px;
            font-weight: 300;
            line-height: 19.2px;
            text-align: left;

              }
              #popup-price{
                font-family: Lustria;
            font-size: 16px;
            font-weight: 400;
            line-height: 19.2px;
            text-align: left;

              }
              #popup-description>p{
                font-family: Jost;
            font-size: 14px;
            font-weight: 300;
            line-height: 15.4px;
            letter-spacing: -0.01em;
            text-align: left;

              }
              .section2 {
                padding: 51px;
              }
              .productGrid {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
              }
              .gridItem {
                width: 433px;
                height: 444px;

              }
              .popup {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);

              }
              .popup-content {
                background-color: #fff;
                margin: 10% auto;
                padding: 20px;

                width: 311px;Ï
                height: 447px;

                gap: 0;

                background: rgba(255, 255, 255, 1);
                box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.2);

              }
</style>

<script>
         const productData = [
           {% for product in products %}{
           'id': "{{ product.id }}",
           'title':"{{ product.title }}",
           'price' : "{{ product.price  }}",
           'description':"{{ product.description }}",
           'image':"{{ product.featured_image | img_url: '300x300' }}",
           'variants':[
             {% for variant in product.variants %}
               {
                 'id':"{{ variant.id }}",
                 'option1':"{{ variant.option1 }}",
                 'option2':"{{ variant.option2 }}",
                 'price':"{{ variant.price }}",
               }
                 {% if forloop.last==false %},{% endif %}
                 {% endfor %}
               ]
             }
                 {% if forloop.last==false %},{% endif %}
                 {% endfor %}
             ]
                 console.log(productData)


         const popup = document.getElementById("product-popup");

         function closePopup() {

           popup.style.display = "none";
         };

         let currentProduct = null;

        function fetchProduct(productId){
         console.log(productId)
           const id = productId.toString();
        console.log(id)
           const product = productData.find(item => item.id === id);

           if (product) {
             console.log(product)


           document.getElementById('popupImg').src = product.image;
         document.getElementById('popup-title').textContent = product.title;

         document.getElementById('popup-price').textContent = product.price+"€"|| '';
         document.getElementById('popup-description').innerHTML = product.description || '';

         const colorOptions = document.getElementById('color-button-group');
         const sizeOptions = document.getElementById('size-options');
         colorOptions.innerHTML = '';
         sizeOptions.innerHTML = '';

         let colors = new Set();
         let sizes = new Set();

         product.variants.forEach(variant => {
           if (variant.option2) colors.add(variant.option2);
           if (variant.option1) sizes.add(variant.option1);
         });
  console.log(colors)
         colors.forEach(color => {
      const colorDiv = document.createElement('div');
      colorDiv.classList.add('color-option');
      colorDiv.setAttribute('data-color', color);

      const colorCircle = document.createElement('span');
      colorCircle.classList.add('colorDiv');
      colorCircle.style.backgroundColor = color;

      const colorName = document.createElement('span');
      colorName.classList.add('colorType');
      colorName.textContent = color;

      colorDiv.appendChild(colorCircle);
      colorDiv.appendChild(colorName);

      colorDiv.onclick = function() {
        document.querySelectorAll('.color-option').forEach(btn => btn.classList.remove('selected'));
        colorDiv.classList.add('selected');
      };

      colorOptions.appendChild(colorDiv);

      const divider = document.createElement('div');
      divider.classList.add('divider');
      colorOptions.appendChild(divider);
    });

         sizes.forEach(size => {
           const sizeOption = document.createElement('option');
           sizeOption.value = size;
           sizeOption.textContent = size;
           sizeOptions.appendChild(sizeOption);
         });

         document.getElementById('product-popup').style.display = 'flex';
                 } else {
             console.error('Product not found!');
           }
       }
      document.addEventListener('DOMContentLoaded', function() {
                 const options = document.querySelectorAll('.color-option');

                 options.forEach(option => {
                     option.addEventListener('click', function() {
                         options.forEach(opt => opt.classList.remove('selected'));
                         this.classList.add('selected');
                     });
                 });
             });
       document.querySelector('.close-popup').addEventListener('click', () => {
         document.getElementById('product-popup').style.display = 'none';
       });
</script>
